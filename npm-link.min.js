/* NpmLink
 * Magically link local npm packages.
 * (c) 2014 David (daXXog) Volm ><> + + + <><
 * Released under Apache License, Version 2.0:
 * http://www.apache.org/licenses/LICENSE-2.0.html  
 */ !function(e,n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define(n):e.NpmLink=n()}(this,function(){var e,n=require("express"),r=require("tar"),t=require("fstream"),o=(require("util").inherits,n.Router()),i=process.cwd();return e=function(e){console.log(e)},o.get("/archive.tar",function(n,o){var u,c=r.Pack({noProprietary:!0}).on("error",e),f=[];c.on("data",function(e){f.push(e)}),c.on("end",function(){u=new Buffer(f.map(function(e){return e.length}).reduce(function(e,n){return e+n})),f.reduce(function(e,n){return"number"!=typeof e&&(e=0),n.copy(u,e,0,n.length+1),e+n.length}),o.set("Content-Type","application/x-tar"),o.send(u)}),t.Reader({path:i,type:"Directory"}).on("error",e).pipe(c)}),o});